#!/usr/bin/env ruby
require 'optparse'
require File.expand_path(File.dirname(__FILE__) + '/../lib/pruner')

options = {}

OptionParser.new do |opts|
  opts.banner = 'Usage: pruner [options] vol-1 vol-2... providing no volumes will default to all volumes associated with the account.'
  
  opts.on('-i', '--aws-id ID', 'AWS ID') do |id|
    options[:aws_id] = id
  end
  
  opts.on('-k', '--aws-key KEY', 'AWS Secret Key') do |key|
    options[:aws_key] = key
  end
  
  options[:verbose] = true
  opts.on('-v', '--[no-]verbose', 'Run verbosely') do |v|
    options[:verbose] = v
  end
  
  options[:live] = false
  opts.on('-l', '--[not-]live', 'Run live') do |l|
    options[:live] = l
  end
  
  opts.on_tail('-h', '--help', 'Show this message') do
    puts "Super Pruner 9000 - #{Pruner::VERSION}"
    puts opts
    exit
  end
  
  begin
    opts.parse!
    
    raise 'You must provide AWS credentials.' unless options[:aws_id] && options[:aws_key]
  rescue Exception => e
    print "ERROR: #{e}\n\n"
    puts opts
    exit
  end
end

options[:volumes] = ARGV

Pruner.new(options).prune!